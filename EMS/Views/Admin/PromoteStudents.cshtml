@model EMS.Models.ViewModels.PromoteStudentViewModel

@{
    ViewData["Title"] = "Promote Students";
}

<div class="d-flex justify-content-between align-items-center mb-4">
    <div>
        <h2 class="text-primary fw-bold"><i class="fa-solid fa-user-graduate me-2"></i> Promote Students</h2>
        <p class="text-muted mb-0">Batch update student semesters.</p>
    </div>
    <a asp-action="Students" class="btn btn-outline-secondary">Back to List</a>
</div>

<div class="card shadow-sm border-0 mb-4">
    <div class="card-body p-4">
        <form method="get" asp-action="PromoteStudents">
            <div class="row g-3 align-items-end mb-4">
                <div class="col-md-4">
                    <label class="form-label fw-bold text-muted">Select Department</label>
                    <select name="departmentId" class="form-select" asp-items="Model.DepartmentList" onchange="this.form.submit()">
                        <option value="">-- Select Department --</option>
                    </select>
                </div>
                <div class="col-md-4">
                    <label class="form-label fw-bold text-muted">Select Current Semester</label>
                    <select name="currentSemesterId" class="form-select" asp-items="Model.SemesterList" onchange="this.form.submit()">
                        <option value="">-- Select Current Semester --</option>
                    </select>
                </div>
            </div>
        </form>

        @if (Model.Students != null && Model.Students.Any())
        {
            <form method="post" asp-action="PromoteStudents">
                <input type="hidden" asp-for="DepartmentId" />
                <input type="hidden" asp-for="CurrentSemesterId" />

                <div asp-validation-summary="ModelOnly" class="alert alert-danger small"></div>

                <div class="mb-4 p-3 bg-light rounded border border-warning">
                    <label asp-for="NextSemesterId" class="form-label fw-bold text-dark">Promote To (Target Semester)</label>
                    <select asp-for="NextSemesterId" class="form-select border-warning" asp-items="Model.SemesterList" required>
                        <option value="">-- Select Next Semester --</option>
                    </select>
                </div>

                <div class="table-responsive mb-4">
                    <table class="table table-hover align-middle">
                        <thead class="bg-light">
                            <tr>
                                <th style="width: 50px;">
                                    <input type="checkbox" id="selectAll" class="form-check-input" checked />
                                </th>
                                <th>Roll No</th>
                                <th>Student Name</th>
                            </tr>
                        </thead>
                        <tbody>
                            @for (int i = 0; i < Model.Students.Count; i++)
                            {
                                <tr>
                                    <td>
                                        <input type="hidden" asp-for="Students[i].StudentId" />
                                        <input type="hidden" asp-for="Students[i].Name" />
                                        <input type="hidden" asp-for="Students[i].RollNo" />
                                        <input asp-for="Students[i].IsSelected" class="form-check-input student-checkbox" />
                                    </td>
                                    <td class="fw-bold">@Model.Students[i].RollNo</td>
                                    <td>@Model.Students[i].Name</td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>

                <button type="submit" class="btn btn-success fw-bold px-4">
                    <i class="fa-solid fa-arrow-up-right-from-square me-2"></i> Confirm Promotion
                </button>
            </form>
        }
        else if (Model.DepartmentId != 0 && Model.CurrentSemesterId != 0)
        {
            <div class="alert alert-info text-center">
                No students found in this semester.
            </div>
        }
    </div>
</div>

@section Scripts {
    <script>
        // Select All চেকবক্স লজিক
        document.getElementById('selectAll').addEventListener('change', function() {
            var checkboxes = document.querySelectorAll('.student-checkbox');
            for (var checkbox of checkboxes) {
                checkbox.checked = this.checked;
            }
        });
    </script>
}